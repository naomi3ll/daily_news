# 📰 新闻聚合功能更新

## 🎯 核心改进：合并排序时间线

### 1️⃣ **热度+时间双重排序**

将所有来源的新闻合并为一个统一列表，按以下规则排序：

**排序优先级：**
```
第一优先级: 热度分数（降序）
  ├─ 暴涨/暴跌：10 分
  ├─ 崩盘/创纪录：9 分
  ├─ 新高/大涨/大跌/获批/制裁：8 分
  ├─ 突破/调查：7 分
  ├─ 反弹：6 分
  ├─ 增长/下降：5 分
  └─ 其他：3-4 分

第二优先级: 发布时间（倒序）
  └─ 热度相同时，最新的文章排在前面
```

**效果：** 热门新闻即使来自不同源也会靠近，形成完整的实时新闻时间线

### 2️⃣ **新闻来源可视化**

每条文章显示来源徽章（小圆形图标）：
- 🟦 **W** (蓝色) = 华尔街见闻
- 🟧 **R** (橙色) = 路透社

用户可以一眼看出每条新闻来自哪个平台

### 3️⃣ **增强的用户交互**

| 功能 | 说明 |
|------|------|
| 🔍 **搜索** | 实时搜索新闻标题 |
| 🔽 **来源筛选** | 按来源显示：全部/华尔街见闻/路透社 |
| 📋 **视图切换** | 卡片视图 ↔ 列表视图，自动保存偏好 |
| 🎨 **主题切换** | 亮色/深色主题，自动保存 |
| ⬆️ **回到顶部** | 悬浮按钮，滚动 300px 后出现 |

### 4️⃣ **情感高亮**

标题中的关键词会自动着色：
- 🔴 **利多词** (红色): 暴涨、获批、大涨、突破、新高 等
- 🟢 **利空词** (绿色): 暴跌、崩盘、调查、制裁、下跌 等

帮助用户快速识别新闻的市场影响

---

## 📊 数据统计

```
总新闻数：        140 条
华尔街见闻：      76 条
路透社：          64 条

热度排序：        ✅ 已实现
时间倒序：        ✅ 已实现
来源混合：        ✅ 已实现
双源时间线：      ✅ 已实现
```

---

## 🔧 技术实现

### 热度算法

```python
def calculate_hotness(item):
    """基于关键词出现频率计算热度"""
    title = item.get('title', '').lower()
    hotness = 0
    
    financial_keywords = {
        '暴涨': 10, '暴跌': 10, '新高': 8,
        '大涨': 8, '大跌': 8, '获批': 8,
        # ... 更多关键词
    }
    
    for keyword, weight in financial_keywords.items():
        hotness += title.count(keyword) * weight
    
    return hotness
```

### 排序逻辑

```python
# 按热度降序，热度相同则按时间降序
sorted_items = sorted(
    items,
    key=lambda x: (x['hotness'], x['datetime_obj']),
    reverse=True
)
```

### HTML 结构

```html
<!-- 单一统一列表，所有新闻混合显示 -->
<ul class='cards'>
  <li class='card' data-source='wallstreetcn'>
    <a href='...' class='title'>文章标题</a>
    <div class='meta'>
      <span class='source-badge' style='background:#1478F0'>W</span>
      <span class='badge'>类型</span>
      <time>发布时间</time>
    </div>
  </li>
  <!-- ... 其他卡片 ... -->
</ul>
```

---

## 🚀 使用方法

### 生成页面

```bash
python scripts/generate_news_page.py
```

### 查看页面

在浏览器中打开 `docs/index.html`

### 页面功能

1. **搜索**：在搜索框输入关键词
2. **筛选**：点击来源按钮筛选
3. **切换视图**：点击右上角视图切换按钮
4. **主题**：点击主题切换按钮
5. **回顶**：滚动时右下角出现回到顶部按钮

---

## ✨ 改进亮点

### 之前 vs 之后

| 方面 | 之前 | 之后 |
|-----|------|------|
| 排列方式 | 按来源分组 | 按热度混合排序 |
| 新闻顺序 | 来源内部顺序 | 完整时间线 |
| 热门新闻 | 分散在各源 | 聚集在顶部 |
| 用户体验 | 需要切换来源 | 一键看全部热点 |
| 视觉反馈 | 来源分开显示 | 小徽章快速识别 |

---

## 🎯 设计思想

**目标**：让用户在一个统一的时间线上看到所有最新的、最热门的新闻

**实现**：
1. 抓取多个来源 ✅
2. 计算每条新闻的热度 ✅
3. 按热度+时间排序 ✅
4. 保留来源标识 ✅
5. 提供过滤和搜索 ✅

**结果**：形成一条由多个来源组成的、按市场热度驱动的、完整的财经新闻时间线

